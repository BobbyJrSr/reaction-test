<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reaction Test</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .hidden {
      display: none;
    }
    button {
      margin-top: 10px;
    }
    #results pre {
      background: #f0f0f0;
      padding: 10px;
      white-space: pre-wrap;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Reaction Test</h1>

  <label>Name: <input id="name" type="text" /></label><br>
  <label>Age: <input id="age" type="number" /></label><br>
  <label>Sex: <input id="sex" type="text" /></label><br><br>

  <button onclick="startTest('visual')">Start Visual Test</button>
  <button onclick="startTest('audio')">Start Audio Test</button>
  <button onclick="reset()">Reset</button>

  <div id="results" class="hidden">
    <h2>Results</h2>
    <pre id="resultText"></pre>
    <button id="copyBtn">Copy Results</button>
  </div>

  <script>
    const nameInput = document.getElementById("name");
    const ageInput = document.getElementById("age");
    const sexInput = document.getElementById("sex");
    const resultText = document.getElementById("resultText");
    const copyBtn = document.getElementById("copyBtn");
    const resultsDiv = document.getElementById("results");

    let visualTimes = [];
    let audioTimes = [];

    function startTest(type) {
      const delay = Math.random() * 2000 + 1000;
      const start = performance.now();
      let timeout;

      if (type === "visual") {
        alert("Wait for the screen to turn green, then tap OK.");
        timeout = setTimeout(() => {
          const ready = confirm("NOW! Tap OK as fast as you can!");
          const end = performance.now();
          const reactionTime = end - start - delay;
          if (reactionTime > 100) visualTimes.push(reactionTime);
          checkDone();
        }, delay);
      } else if (type === "audio") {
        alert("Wait for the beep, then tap OK.");
        timeout = setTimeout(() => {
          const audio = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
          audio.play();
          const ready = confirm("NOW! Tap OK as fast as you can!");
          const end = performance.now();
          const reactionTime = end - start - delay;
          if (reactionTime > 100) audioTimes.push(reactionTime);
          checkDone();
        }, delay);
      }
    }

    function checkDone() {
      if (visualTimes.length >= 3 && audioTimes.length >= 3) {
        showResults();
      }
    }

    function showResults() {
      const visualAvg = visualTimes.reduce((a, b) => a + b) / visualTimes.length;
      const audioAvg = audioTimes.reduce((a, b) => a + b) / audioTimes.length;

      const output = `
Name: ${nameInput.value}
Age: ${ageInput.value}
Sex: ${sexInput.value}

Visual Times (ms): ${visualTimes.map(t => t.toFixed(0)).join(", ")}
Visual Average: ${visualAvg.toFixed(2)} ms

Audio Times (ms): ${audioTimes.map(t => t.toFixed(0)).join(", ")}
Audio Average: ${audioAvg.toFixed(2)} ms

The End`.trim();

      resultText.textContent = output;
      resultText.dataset.rawText = output;
      resultsDiv.classList.remove("hidden");
    }

    copyBtn.onclick = () => {
      const cleanText = resultText.dataset.rawText || resultText.textContent;
      navigator.clipboard.writeText(cleanText)
        .then(() => alert("Copied to clipboard!"))
        .catch(err => alert("Failed to copy."));
    };

    function reset() {
      visualTimes = [];
      audioTimes = [];
      resultText.textContent = "";
      resultText.dataset.rawText = "";
      resultsDiv.classList.add("hidden");
    }
  </script>
</body>
</html>
