<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reaction Time Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
      background-color: #f4f4f4;
    }
    h1 {
      margin-bottom: 10px;
    }
    input, select, button {
      padding: 10px;
      margin: 5px;
      font-size: 1rem;
    }
    #testBox {
      margin: 20px auto;
      width: 80%;
      max-width: 400px;
      height: 200px;
      display: none;
      align-items: center;
      justify-content: center;
      background-color: #3498db;
      color: white;
      font-size: 1.2rem;
      border-radius: 12px;
      user-select: none;
    }
    #resultsBox {
      display: none;
      margin-top: 20px;
    }
    #copyText {
      width: 100%;
      height: 120px;
      margin-top: 10px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>Reaction Time Test</h1>
  <p>Enter your details:</p>
  <input type="text" id="name" placeholder="Name" required />
  <input type="number" id="age" placeholder="Age" required />
  <select id="sex">
    <option value="">Sex</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
    <option value="Other">Other</option>
  </select>
  <br />
  <button id="startBtn">Start Test</button>

  <div id="testBox">Click to start</div>

  <div id="resultsBox">
    <h2>Results</h2>
    <div id="resultOutput"></div>
    <textarea id="copyText" readonly></textarea><br />
    <button id="copyBtn">Copy to Clipboard</button>
  </div>

  <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const startBtn = document.getElementById("startBtn");
      const testBox = document.getElementById("testBox");
      const resultOutput = document.getElementById("resultOutput");
      const resultsBox = document.getElementById("resultsBox");
      const beep = document.getElementById("beep");
      const copyBtn = document.getElementById("copyBtn");
      const textarea = document.getElementById("copyText");

      let name, age, sex;
      let visualTimes = [], audioTimes = [];
      let currentType = "visual", count = 0, startTime = null;

      copyBtn.addEventListener("click", () => {
        textarea.select();
        textarea.setSelectionRange(0, 99999); // For mobile
        document.execCommand("copy");
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy to Clipboard"), 2000);
      });

      startBtn.addEventListener("click", () => {
        name = document.getElementById("name").value.trim();
        age = document.getElementById("age").value.trim();
        sex = document.getElementById("sex").value.trim();

        if (!name || !age || !sex) {
          alert("Please enter your name, age, and sex.");
          return;
        }

        visualTimes = [];
        audioTimes = [];
        currentType = "visual";
        count = 0;
        resultsBox.style.display = "none";
        testBox.style.display = "flex";
        showInstruction("visual");
      });

      function showInstruction(type) {
        testBox.innerText = type === "visual"
          ? "Watch the box. Click when it turns green!"
          : "Listen for the beep. Click as fast as you can!";
        testBox.style.backgroundColor = "#3498db";
        setTimeout(runTrial, 2500);
      }

      function runTrial() {
        testBox.innerText = "Wait for the cue...";
        testBox.style.backgroundColor = "#3498db";
        const delay = Math.floor(Math.random() * 3000) + 1000;
        setTimeout(() => {
          startTime = Date.now();
          if (currentType === "visual") {
            testBox.style.backgroundColor = "#2ecc71";
            testBox.innerText = "CLICK!";
          } else {
            beep.loop = true;
            beep.play();
            testBox.innerText = "CLICK!";
          }
        }, delay);
      }

      testBox.addEventListener("click", () => {
        if (!startTime) return;

        const reactionTime = Date.now() - startTime;
        if (currentType === "audio") {
          beep.pause();
          beep.currentTime = 0;
        }

        (currentType === "visual" ? visualTimes : audioTimes).push(reactionTime);
        startTime = null;
        count++;

        if (count < 5) {
          runTrial();
        } else if (currentType === "visual") {
          currentType = "audio";
          count = 0;
          showInstruction("audio");
        } else {
          showResults();
        }
      });

      function showResults() {
        testBox.style.display = "none";
        resultsBox.style.display = "block";
        const avgVisual = Math.round(visualTimes.reduce((a, b) => a + b, 0) / visualTimes.length);
        const avgAudio = Math.round(audioTimes.reduce((a, b) => a + b, 0) / audioTimes.length);
        const summary = `
Name: ${name}
Age: ${age}
Sex: ${sex}
Avg Visual: ${avgVisual} ms
Avg Audio: ${avgAudio} ms
Visual Times: ${visualTimes.join(", ")} ms
Audio Times: ${audioTimes.join(", ")} ms`;

        resultOutput.innerHTML = summary.replace(/\n/g, "<br>");
        textarea.value = summary.trim();
      }
    });
  </script>
</body>
</html>
